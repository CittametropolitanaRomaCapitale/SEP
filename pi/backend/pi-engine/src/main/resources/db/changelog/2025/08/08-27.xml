<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.9.xsd">

    <changeSet id="create_pec_regole" author="Gioacchino De Fusco">
        <createTable tableName="pec_regole">
            <column name="id" type="BIGINT">
                <constraints primaryKey="true"/>
            </column>
            <column name="id_email" type="BIGINT" />
            <column name="id_categoria" type="TINYINT" />
            <column name="threshold" type="BIGINT" />
            <column name="duration_minutes" type="BIGINT"/>
            <column name="is_enabled" type="BOOLEAN"/>
            <column name="description" type="VARCHAR(128)"/>
            <column name="ts_creation" type="TIMESTAMP"/>
            <column name="ts_last_invio_notifica" type="TIMESTAMP"/>
        </createTable>
    </changeSet>
    <changeSet id="default_value_ts_creation_pec_escluse" author="michela carnevale">
        <createTable tableName="pec_regole_finestra_temporale">
            <column name="id" type="BIGINT">
                <constraints primaryKey="true"/>
            </column>
            <column name="day_of_week" type="SMALLINT">
                <constraints nullable="false" />
            </column>
            <column name="start_time" type="TIME">
                <constraints nullable="false" />
            </column>
            <column name="end_time" type="TIME">
                <constraints nullable="false" />
            </column>
        </createTable>
    </changeSet>

    <changeSet id="create-pec_regole_finestre_temporali" author="Gioacchino De Fusco">
        <createTable tableName="pec_regole_finestre_temporali">
            <column name="id_regola" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="id_finestra" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <addForeignKeyConstraint
                baseTableName="pec_regole_finestre_temporali"
                baseColumnNames="id_regola"
                referencedTableName="pec_regole"
                referencedColumnNames="id"
                constraintName="fk_regola_to_pec_regola"/>

        <addForeignKeyConstraint
                baseTableName="pec_regole_finestre_temporali"
                baseColumnNames="id_finestra"
                referencedTableName="pec_regole_finestra_temporale"
                referencedColumnNames="id"
                constraintName="fk_finestra_to_pec_regola_finestra_temporale"/>

        <addPrimaryKey
                columnNames="id_regola, id_finestra"
                constraintName="pk_pec_regole_finestre_temporali"
                tableName="pec_regole_finestre_temporali"/>
    </changeSet>

</databaseChangeLog>